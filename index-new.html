<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ãŠé¡˜ã„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ã‚·ãƒƒã‚¯', 'Yu Gothic UI', 'Meiryo UI', sans-serif;
            background: linear-gradient(135deg, #f5f3f0 0%, #e8f5e8 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: #4a5568;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .logo-area {
            width: 140px;
            height: 90px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-radius: 40px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
            position: relative;
            line-height: 1.3;
        }
        
        .logo-area::before {
            content: 'ğŸŒ±';
            position: absolute;
            top: -5px;
            right: 10px;
            font-size: 24px;
        }

        .title {
            font-size: 28px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .subtitle {
            font-size: 16px;
            color: #718096;
            margin-bottom: 20px;
        }

        .features {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .feature-tag {
            background: #e6f3e6;
            color: #2f855a;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .required {
            color: #e53e3e;
            font-size: 12px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .form-input:focus {
            outline: none;
            border-color: #81c784;
            background: white;
            box-shadow: 0 0 0 3px rgba(129, 199, 132, 0.1);
        }

        .upload-area {
            border: 3px dashed #cbd5e0;
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            background: #f7fafc;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .upload-area.dragover {
            border-color: #81c784;
            background: #f0fff4;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            color: #a0aec0;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 18px;
            color: #4a5568;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .upload-subtext {
            font-size: 14px;
            color: #718096;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .file-info {
            background: #e6f3e6;
            border-radius: 12px;
            padding: 12px;
            margin-top: 10px;
            display: block;
            margin-bottom: 10px;
        }

        .file-name {
            font-weight: 600;
            color: #2f855a;
            margin-bottom: 5px;
        }

        .file-size {
            font-size: 14px;
            color: #68d391;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #81c784, #66bb6a);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(129, 199, 132, 0.3);
        }
        
        .submit-btn.loading {
            background-color: #bdbdbd;
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        .submit-btn.loading::after {
            content: '...';
            display: inline-block;
            animation: loadingDots 1.5s infinite;
        }
        
        @keyframes loadingDots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .submit-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .thanks-screen {
            display: none;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 50px 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .thanks-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .thanks-title {
            font-size: 24px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .thanks-message {
            font-size: 16px;
            color: #4a5568;
            margin-bottom: 25px;
        }

        .instagram-info {
            background: #fef5e7;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .instagram-title {
            font-weight: 600;
            color: #744210;
            margin-bottom: 8px;
        }

        .instagram-text {
            font-size: 14px;
            color: #975a16;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .header {
                padding: 25px 15px;
            }
            
            .title {
                font-size: 24px;
            }
            
            .form-container {
                padding: 25px 20px;
            }
            
            .upload-area {
                padding: 30px 15px;
            }
        }

        .error-message {
            color: #e53e3e;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #81c784, #66bb6a);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .server-status {
            background: #e6f3e6;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            color: #2f855a;
        }

        .server-status.error {
            background: #ffe6e6;
            color: #e53e3e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-area">å§«è·¯ã®ç¨®ï¼†<br>ãƒ–ãƒ‰ã‚¦ã¡ã‚ƒã‚“</div>
            <h1 class="title">ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ãŠé¡˜ã„</h1>
            <p class="subtitle">
                ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»æŠ•ç¨¿ç”¨ã«ä½¿ã‚ã›ã¦ã„ãŸã ããŸã‚ã€<strong>5ã€œ10ç§’ç¨‹åº¦</strong>ã®ã‚¹ãƒãƒ›ã§æ’®å½±ã—ãŸå‹•ç”»ã‚’ã”æä¾›ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ğŸ˜Š<br>
                <small style="color: #68d391; font-weight: 600;">ğŸ“ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå‹•ç”»ã¯ã€Œå§«è·¯ã®ç¨®ï¼†ãƒ–ãƒ‰ã‚¦ã¡ã‚ƒã‚“ã€å°‚ç”¨ã‚µãƒ¼ãƒãƒ¼ã«å®‰å…¨ã«ä¿å­˜ã•ã‚Œã¾ã™</small>
            </p>
            <div class="features">
                <span class="feature-tag">âœ… æœ€å¤§5å‹•ç”»ã¾ã§</span>
                <span class="feature-tag">âœ… 5ã€œ10ç§’ç¨‹åº¦</span>
                <span class="feature-tag">âœ… é«˜ç”»è³ªä¿å­˜</span>
            </div>
        </div>

        <form id="uploadForm" class="form-container">
            <div id="serverStatus" class="server-status">
                ğŸ“¡ ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šç¢ºèªä¸­...
            </div>

            <div class="form-group">
                <label class="form-label">
                    ãŠåº—ã®åå‰ <span class="required">*å¿…é ˆ</span>
                </label>
                <input type="text" class="form-input" id="storeName" name="storeName" placeholder="åº—èˆ—åãƒ»æ‹…å½“è€…åã‚’ã”å…¥åŠ›ãã ã•ã„" required>
                <div class="error-message" id="storeNameError">ãŠåº—ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            </div>

            <div class="form-group">
                <label class="form-label">
                    å‹•ç”»ã®èª¬æ˜ <span class="required">*å¿…é ˆ</span>
                </label>
                <textarea class="form-input" id="videoDescription" name="videoDescription" rows="4" placeholder="ä¾‹ï¼‰åº—å†…ã®æ§˜å­ã€ãŠã™ã™ã‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼åï¼‰" required></textarea>
                <div class="error-message" id="videoDescriptionError">å‹•ç”»ã®èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            </div>

            <div class="form-group">
                <label class="form-label">
                    ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ç´ æ <span class="required">*å¿…é ˆ</span> <span style="font-size: 12px; color: #68d391;">(æœ€å¤§5å‹•ç”»ã¾ã§)</span>
                </label>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ¬</div>
                    <div class="upload-text">ã“ã“ã«å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    <div class="upload-subtext">ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
                    <div class="upload-subtext" style="font-size: 12px; color: #a0aec0;">
                        ğŸ“± ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»: 5ã€œ10ç§’ç¨‹åº¦<br>
                        ğŸï¸ å¯¾å¿œå½¢å¼: MP4, MOV, AVI (1å‹•ç”»200MBã¾ã§)
                    </div>
                </div>
                <input type="file" class="file-input" id="videoFile" name="videoFile" accept="video/*" multiple required>
                
                <div id="filesList" style="margin-top: 15px;"></div>
                
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="error-message" id="videoFileError">å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">
                ğŸ¬ ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
            </button>
        </form>

        <div class="thanks-screen" id="thanksScreen">
            <div class="thanks-icon">ğŸ‰</div>
            <h2 class="thanks-title">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼</h2>
            <p class="thanks-message">
                ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸã€‚<br>
                <strong style="color: #2f855a;">ğŸ“ ã€Œå§«è·¯ã®ç¨®ï¼†ãƒ–ãƒ‰ã‚¦ã¡ã‚ƒã‚“ã€ã®ã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸ</strong><br>
                ç¢ºèªå¾Œã€ã”é€£çµ¡ã„ãŸã—ã¾ã™ğŸ“©
            </p>
            
            <div class="instagram-info">
                <div class="instagram-title">ğŸ“¸ InstagramæŠ•ç¨¿æ™‚ã®ãŠé¡˜ã„</div>
                <div class="instagram-text">
                    æŠ•ç¨¿ã®éš›ã¯ã€ã‚ˆã‚ã—ã‘ã‚Œã°ã‚¿ã‚°ä»˜ã‘ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™âœ¨<br>
                    ï¼ˆä»»æ„ã§ã™ï¼‰
                </div>
            </div>
        </div>
    </div>

    <script>
        // è¨­å®š
        const CONFIG = {
            // æœ¬ç•ªç’°å¢ƒã§ã¯å®Ÿéš›ã®VPSã®URLã«å¤‰æ›´
            SERVER_URL: 'http://160.251.176.214:3000',
            // ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨
            // SERVER_URL: 'http://localhost:3000',
            MAX_FILE_SIZE: 200 * 1024 * 1024, // 200MB
            MAX_FILES: 5
        };

        // DOMè¦ç´ 
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('videoFile');
        const filesList = document.getElementById('filesList');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const form = document.getElementById('uploadForm');
        const submitBtn = document.getElementById('submitBtn');
        const thanksScreen = document.getElementById('thanksScreen');
        const serverStatus = document.getElementById('serverStatus');

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('æ–°ã—ã„å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ  åˆæœŸåŒ–é–‹å§‹');
            checkServerConnection();
            initializeEventListeners();
        });

        // ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šç¢ºèª
        async function checkServerConnection() {
            try {
                const response = await fetch(`${CONFIG.SERVER_URL}/api/health`, {
                    method: 'GET',
                    timeout: 5000
                });
                
                if (response.ok) {
                    serverStatus.textContent = 'âœ… ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šæ­£å¸¸';
                    serverStatus.className = 'server-status';
                    submitBtn.disabled = false;
                } else {
                    throw new Error('ã‚µãƒ¼ãƒãƒ¼å¿œç­”ã‚¨ãƒ©ãƒ¼');
                }
            } catch (error) {
                console.error('ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼:', error);
                serverStatus.textContent = 'âŒ ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã§ãã¾ã›ã‚“ï¼ˆé–‹ç™ºä¸­ã®å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰';
                serverStatus.className = 'server-status error';
                submitBtn.disabled = false; // é–‹ç™ºä¸­ã¯ãƒ†ã‚¹ãƒˆå¯èƒ½ã«ã™ã‚‹
            }
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼åˆæœŸåŒ–
        function initializeEventListeners() {
            // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('click', () => fileInput.click());

            // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
            fileInput.addEventListener('change', handleFileSelect);

            // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
            form.addEventListener('submit', handleFormSubmit);
        }

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave() {
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('video/'));
            
            if (files.length > 0) {
                const selectedFiles = files.slice(0, CONFIG.MAX_FILES);
                const dt = new DataTransfer();
                selectedFiles.forEach(file => dt.items.add(file));
                fileInput.files = dt.files;
                displayFiles(selectedFiles);
            } else {
                alert('å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                const files = Array.from(e.target.files).slice(0, CONFIG.MAX_FILES);
                displayFiles(files);
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤º
        function displayFiles(files) {
            filesList.innerHTML = '';
            
            let hasError = false;
            
            files.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-info';
                
                let statusIcon = 'âœ…';
                let statusColor = '#2f855a';
                let errorMsg = '';
                
                if (file.size > CONFIG.MAX_FILE_SIZE) {
                    statusIcon = 'âŒ';
                    statusColor = '#e53e3e';
                    errorMsg = ' (200MBã‚’è¶…ãˆã¦ã„ã¾ã™)';
                    hasError = true;
                }
                
                fileItem.innerHTML = `
                    <div class="file-name" style="color: ${statusColor};">
                        ${statusIcon} ${file.name}${errorMsg}
                    </div>
                    <div class="file-size" style="color: ${statusColor};">
                        ${formatFileSize(file.size)}
                    </div>
                `;
                
                filesList.appendChild(fileItem);
            });
            
            if (files.length > CONFIG.MAX_FILES) {
                const errorDiv = document.createElement('div');
                errorDiv.style.color = '#e53e3e';
                errorDiv.style.fontSize = '14px';
                errorDiv.style.marginTop = '10px';
                errorDiv.textContent = `âš ï¸ å‹•ç”»ã¯${CONFIG.MAX_FILES}ã¤ã¾ã§ã—ã‹é¸æŠã§ãã¾ã›ã‚“`;
                filesList.appendChild(errorDiv);
                hasError = true;
            }
            
            const videoFileError = document.getElementById('videoFileError');
            if (hasError) {
                videoFileError.textContent = 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¾ãŸã¯å€‹æ•°ã«å•é¡ŒãŒã‚ã‚Šã¾ã™';
                videoFileError.style.display = 'block';
            } else {
                videoFileError.style.display = 'none';
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!validateForm()) {
                return;
            }

            try {
                await uploadFiles();
            } catch (error) {
                console.error('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
                handleUploadError(error);
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        function validateForm() {
            let isValid = true;
            const storeName = document.getElementById('storeName');
            const videoDescription = document.getElementById('videoDescription');
            const videoFile = document.getElementById('videoFile');
            
            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
            
            if (!storeName.value.trim()) {
                document.getElementById('storeNameError').style.display = 'block';
                isValid = false;
            }
            
            if (!videoDescription.value.trim()) {
                document.getElementById('videoDescriptionError').style.display = 'block';
                isValid = false;
            }
            
            if (!videoFile.files.length) {
                document.getElementById('videoFileError').textContent = 'å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„';
                document.getElementById('videoFileError').style.display = 'block';
                isValid = false;
            }

            return isValid;
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        async function uploadFiles() {
            const storeName = document.getElementById('storeName');
            const videoDescription = document.getElementById('videoDescription');
            const videoFile = document.getElementById('videoFile');

            // UIã‚’æ›´æ–°
            submitBtn.disabled = true;
            submitBtn.textContent = 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æº–å‚™ä¸­...';
            submitBtn.classList.add('loading');
            
            // FormDataä½œæˆ
            const formData = new FormData();
            formData.append('storeName', storeName.value);
            formData.append('description', videoDescription.value);
            
            for (let i = 0; i < videoFile.files.length; i++) {
                formData.append('videos', videoFile.files[i]);
            }
            
            submitBtn.textContent = 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...';
            progressBar.style.display = 'block';
            
            // XMLHttpRequestã§ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = Math.round((e.loaded / e.total) * 100);
                        progressFill.style.width = percentComplete + '%';
                        submitBtn.textContent = `ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­... ${percentComplete}%`;
                    }
                });
                
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.success) {
                                progressFill.style.width = '100%';
                                submitBtn.textContent = 'å®Œäº†ï¼';
                                
                                setTimeout(() => {
                                    form.style.display = 'none';
                                    thanksScreen.style.display = 'block';
                                    resolve(response);
                                }, 500);
                            } else {
                                reject(new Error(response.error || 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ'));
                            }
                        } catch (e) {
                            reject(new Error('ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã‚’å‡¦ç†ã§ãã¾ã›ã‚“ã§ã—ãŸ'));
                        }
                    } else {
                        let errorMessage = 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ';
                        try {
                            const errorData = JSON.parse(xhr.responseText);
                            if (errorData.error) {
                                errorMessage = errorData.error;
                            }
                        } catch (e) {
                            // ã‚¨ãƒ©ãƒ¼è§£æå¤±æ•—æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½¿ç”¨
                        }
                        reject(new Error(errorMessage));
                    }
                };
                
                xhr.onerror = function() {
                    reject(new Error('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'));
                };
                
                xhr.open('POST', `${CONFIG.SERVER_URL}/api/upload`);
                xhr.send(formData);
            });
        }

        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        function handleUploadError(error) {
            let errorMessage = 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
            
            if (error.message) {
                errorMessage += '\n\n' + error.message;
            }
            
            if (error.message && error.message.includes('NetworkError')) {
                errorMessage += '\n\nã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
            }
            
            alert(errorMessage);
            
            // UIå¾©å¸°
            submitBtn.disabled = false;
            submitBtn.textContent = 'ğŸ¬ ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹';
            submitBtn.classList.remove('loading');
            progressBar.style.display = 'none';
            progressFill.style.width = '0%';
        }

        console.log('âœ… æ–°ã—ã„å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
        console.log('ğŸ“¡ ã‚µãƒ¼ãƒãƒ¼URL:', CONFIG.SERVER_URL);
    </script>
</body>
</html>